#!/usr/bin/env ruby
# frozen_string_literal: true

require 'kingsly_certbot'

# kingsly-certbot --config /opt/kingsly-certbot/kingsly-certbot.conf
log_dir = ENV['LOG_DIR'] || '/var/log'
$logger = if Dir.exists?(log_dir)
            file = File.open("#{log_dir}/kingsly-certbot.log", 'a')
            Logger.new(file, level: ENV['LOG_LEVEL'] || 'info')
          else
            Logger.new(STDOUT)
          end
certbot = begin
  KingslyCertbot::Runner.new(ARGV)
rescue StandardError => e
  $logger.fatal(e)
  $logger.fatal(e.backtrace.join("\n"))
  return 1
end

certbot.configure.execute
